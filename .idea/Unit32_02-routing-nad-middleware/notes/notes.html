<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Express Routing, Middleware</title>

    <link rel="stylesheet" href="_static/pygments.css" type="text/css"/>
    <link rel="stylesheet" href="_static/handouts-sphinx.css"/>


    <link href='https://fonts.googleapis.com/css?family=Roboto:400,600,700,400italic,600italic,700italic|Source+Code+Pro:400,700'
          rel='stylesheet' type='text/css'>

</head>
<body>
<div id="page-wrapper">
    <div id="page-sidebar">
        <header>
            <p class="project">Springboard</p>

            <p class="title">Express Routing, Middleware</p>

            <p class="backlink"><a href="index.html"> &laquo; Back to Homepage</a></p>

        </header>
        <div id="toc">
            <ul>
                <li><a class="reference internal" href="index.html#">Express Routing, Middleware</a><ul>
                    <li><a class="reference internal" href="index.html#express-router">Express Router</a><ul>
                        <li><a class="reference internal" href="index.html#id1">Express Router</a></li>
                        <li><a class="reference internal" href="index.html#a-router-outside-of-app-js">A Router Outside of <cite>app.js</cite></a></li>
                        <li><a class="reference internal" href="index.html#using-our-router-in-app-js">Using Our Router in <cite>app.js</cite></a></li>
                        <li><a class="reference internal" href="index.html#benefits-of-the-express-router">Benefits of the Express Router</a></li>
                    </ul>
                    </li>
                    <li><a class="reference internal" href="index.html#middleware">Middleware</a><ul>
                        <li><a class="reference internal" href="index.html#what-is-middleware">What is Middleware?</a></li>
                        <li><a class="reference internal" href="index.html#when-would-you-use-it">When would you use it?</a></li>
                        <li><a class="reference internal" href="index.html#what-does-it-look-like">What does it look like?</a></li>
                        <li><a class="reference internal" href="index.html#why-do-we-need-next">Why do we need <cite>next</cite>?</a></li>
                        <li><a class="reference internal" href="index.html#using-our-middleware">Using our middleware</a></li>
                        <li><a class="reference internal" href="index.html#writing-middleware-to-authorize">Writing middleware to authorize</a></li>
                        <li><a class="reference internal" href="index.html#id2">Using our middleware</a></li>
                        <li><a class="reference internal" href="index.html#using-external-middleware">Using external middleware</a></li>
                        <li><a class="reference internal" href="index.html#summarizing-middleware">Summarizing Middleware</a></li>
                    </ul>
                    </li>
                    <li><a class="reference internal" href="index.html#integration-tests-in-express-setup">Integration Tests in Express: Setup</a><ul>
                        <li><a class="reference internal" href="index.html#integration-tests">Integration Tests</a></li>
                        <li><a class="reference internal" href="index.html#integration-tests-with-supertest">Integration Tests with Supertest</a></li>
                        <li><a class="reference internal" href="index.html#installing-supertest">Installing Supertest</a></li>
                        <li><a class="reference internal" href="index.html#creating-a-server-js">Creating a server.js</a></li>
                        <li><a class="reference internal" href="index.html#what-our-app-js-looks-like">What our app.js looks like</a></li>
                        <li><a class="reference internal" href="index.html#what-our-server-js-looks-like">What our server.js looks like</a></li>
                        <li><a class="reference internal" href="index.html#the-application-we-are-going-to-be-building">The application we are going to be building</a></li>
                        <li><a class="reference internal" href="index.html#what-our-test-setup-looks-like">What our test setup looks like</a></li>
                        <li><a class="reference internal" href="index.html#what-should-i-test">What should I test?</a></li>
                        <li><a class="reference internal" href="index.html#testing-reading">Testing Reading</a></li>
                        <li><a class="reference internal" href="index.html#testing-creating">Testing Creating</a></li>
                        <li><a class="reference internal" href="index.html#testing-updating">Testing Updating</a></li>
                        <li><a class="reference internal" href="index.html#testing-deleting">Testing Deleting</a></li>
                        <li><a class="reference internal" href="index.html#debugging-your-tests">Debugging your tests</a></li>
                        <li><a class="reference internal" href="index.html#coming-up">Coming Up</a></li>
                    </ul>
                    </li>
                </ul>
                </li>
            </ul>

        </div>
    </div>
    <div id="page-content">

        <div class="section" id="express-routing-middleware">
            <h1>Express Routing, Middleware</h1>
            <div class="section" id="express-router">
                <h2>Express Router</h2>
                <p><a class="reference external" href="../express-router-middleware-demo.zip">Download Demo Code</a></p>
                <div class="section" id="id1">
                    <div class="docutils container">
                        <ul class="simple">
                            <li>Placing all routes in <cite>app.js</cite> gets messy quickly!</li>
                            <li>Express provides feature to place routes elsewhere and use them in <cite>app.js</cite>!</li>
                        </ul>
                    </div>
                </div>
                <div class="section" id="a-router-outside-of-app-js">
                    <h3>A Router Outside of <cite>app.js</cite></h3>
                    <div class="literal-block-wrapper docutils container" id="id3">
                        <div class="code-block-caption"><span class="caption-text">demo/routing-demo/routes.js</span></div>
                        <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">);</span>
<span class="hll"><span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
</span>
<span class="kr">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="p">[];</span>

<span class="cm">/** GET /users: get list of users */</span>

<span class="hll"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span>  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">users</span><span class="p">);</span>
<span class="p">});</span>

<span class="cm">/** DELETE /users/[id]: delete user, return status */</span>

<span class="hll"><span class="nx">router</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s2">&quot;/:id&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span>  <span class="kr">const</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">users</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">u</span> <span class="p">=&gt;</span> <span class="nx">u</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="o">+</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="nx">users</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&quot;Deleted&quot;</span> <span class="p">});</span>
<span class="p">});</span>


<span class="hll"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</span></pre></div>
                        </div>
                    </div>
                </div>
                <div class="section" id="using-our-router-in-app-js">
                    <h3>Using Our Router in <cite>app.js</cite></h3>
                    <p>We apply the router to all <em>/users</em> routes with <cite>app.use</cite>:</p>
                    <div class="docutils container">
                        <div class="literal-block-wrapper docutils container" id="id4">
                            <div class="code-block-caption"><span class="caption-text">demo/routing-demo/app.js</span></div>
                            <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">//  apply a prefix to every route in userRoutes</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&quot;/users&quot;</span><span class="p">,</span> <span class="nx">userRoutes</span><span class="p">);</span>
</pre></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section" id="benefits-of-the-express-router">
                    <h3>Benefits of the Express Router</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>We can make our <cite>app.js</cite> file smaller and more readable.</li>
                            <li>We can separate different RESTful resources into their own files:<ul>
                                <li><em>/users</em> has its own router inside <cite>userRoutes.js</cite></li>
                                <li><em>/pets</em> has its own router inside <cite>petRoutes.js</cite></li>
                            </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="section" id="middleware">
                <h2>Middleware</h2>
                <div class="section" id="what-is-middleware">
                    <h3>What is Middleware?</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>It is code that runs in the <strong>middle</strong> of the request / response cycle!</li>
                            <li>In Express, middleware are functions that get access to the <cite>req</cite> and <cite>res</cite> objects and can also call the <cite>next</cite> function.</li>
                            <li><cite>express.json()</cite> is an example of middleware</li>
                            <li>Our 404 and global error handler are example of middleware</li>
                        </ul>
                    </div>
                </div>
                <div class="section" id="when-would-you-use-it">
                    <h3>When would you use it?</h3>
                    <div class="docutils container">
                        <p>It opens up the door for separating our code into more logical groupings and providing more robust / abstracted error handling.</p>
                    </div>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>Logging useful information on every request</li>
                            <li>Adding a <strong>current_user</strong> for every request (like <cite>g</cite> in Flask!)</li>
                            <li>Ensuring that users are authenticated</li>
                            <li>Ensuring that a user is authorized to access an endpoint</li>
                        </ul>
                    </div>
                </div>
                <div class="section" id="what-does-it-look-like">
                    <h3>What does it look like?</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>In another file called <cite>middleware.js</cite></li>
                        </ul>
                    </div>
                    <div class="docutils container">
                        <div class="literal-block-wrapper docutils container" id="id5">
                            <div class="code-block-caption"><span class="caption-text">demo/routing-demo/middleware.js</span></div>
                            <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">logger</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Sending </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="si">}</span><span class="sb"> request to </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">path</span><span class="si">}</span><span class="sb">.`</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section" id="why-do-we-need-next">
                    <h3>Why do we need <cite>next</cite>?</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>If we do not include it, we will not make it to the <em>next</em> route!</li>
                            <li>Notice here we are <strong>not</strong> passing anything to <cite>next</cite>.</li>
                            <li>If argument are passed to <cite>next</cite>, Express <strong>always</strong> treats this as an error.</li>
                        </ul>
                    </div>
                </div>
                <div class="section" id="using-our-middleware">
                    <h3>Using our middleware</h3>
                    <div class="literal-block-wrapper docutils container" id="id6">
                        <div class="code-block-caption"><span class="caption-text">demo/routing-demo/app.js</span></div>
                        <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">middleware</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./middleware&quot;</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="c1">// this applies to all requests at all paths</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">middleware</span><span class="p">.</span><span class="nx">logger</span><span class="p">);</span>
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="section" id="writing-middleware-to-authorize">
                    <h3>Writing middleware to authorize</h3>
                    <div class="literal-block-wrapper docutils container" id="id7">
                        <div class="code-block-caption"><span class="caption-text">demo/routing-demo/middleware.js</span></div>
                        <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">ExpressError</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./expressError&quot;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">onlyAllowElie</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;Elie&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">ExpressError</span><span class="p">(</span><span class="s2">&quot;Unauthorized&quot;</span><span class="p">,</span> <span class="mi">401</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">logger</span><span class="p">,</span> <span class="nx">onlyAllowElie</span> <span class="p">};</span>
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="section" id="id2">
                    <h3>Using our middleware</h3>
                    <div class="literal-block-wrapper docutils container" id="id8">
                        <div class="code-block-caption"><span class="caption-text">demo/routing-demo/app.js</span></div>
                        <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// route handler with middleware</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span>
  <span class="s2">&quot;/hello/:name&quot;</span><span class="p">,</span>
<span class="hll">  <span class="nx">middleware</span><span class="p">.</span><span class="nx">onlyAllowElie</span><span class="p">,</span>
</span>  <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="section" id="using-external-middleware">
                    <h3>Using external middleware</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>Instead of writing our own logger, we will use a more robust one called <cite>morgan</cite></li>
                            <li>When using external middleware, we follow a simple process:<ul>
                                <li>install it - <cite>npm install morgan</cite></li>
                                <li>require it - <cite>const morgan = require(“morgan”);</cite></li>
                                <li>use it - <cite>app.use(morgan(‘dev’));</cite></li>
                            </ul>
                            </li>
                            <li>Once you have set up morgan, take a look at your terminal on each request and you will see the route requested, HTTP verb, and much more.</li>
                        </ul>
                    </div>
                </div>
                <div class="section" id="summarizing-middleware">
                    <h3>Summarizing Middleware</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>We’ve already been using built in middleware like <cite>express.json()</cite></li>
                            <li>Middleware are functions that can intercept the request/response cycle</li>
                            <li>When using external middleware, make sure to first install, require, and then use.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="section" id="integration-tests-in-express-setup">
                <h2>Integration Tests in Express: Setup</h2>
                <div class="section" id="integration-tests">
                    <h3>Integration Tests</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>Making sure the parts work together</li>
                            <li>Essential to have along with unit tests!</li>
                            <li>More involved than unit tests</li>
                        </ul>
                    </div>
                </div>
                <div class="section" id="integration-tests-with-supertest">
                    <h3>Integration Tests with Supertest</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>A library for testing Express applications</li>
                            <li>Our tool for integration testing</li>
                            <li>Like Flask’s test client: can make requests against app in tests</li>
                            <li>Docs: <a class="reference external" href="https://github.com/visionmedia/supertest">https://github.com/visionmedia/supertest</a></li>
                        </ul>
                    </div>
                </div>
                <div class="section" id="installing-supertest">
                    <h3>Installing Supertest</h3>
                    <pre class="console literal-block">
$ <span class="cmd">npm i --save-dev supertest</span>
</pre>
                </div>
                <div class="section" id="creating-a-server-js">
                    <h3>Creating a server.js</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>To create a test client, we are going to need our <cite>app</cite> variable from <cite>app.js</cite></li>
                            <li>Right now we are combining logic to create the <cite>app</cite> variable and start the server all in one file</li>
                            <li>To ensure we don’t start the server when we import our <cite>app</cite> variable in our tests, we’re going to move out our <cite>app.listen</cite> code into a file called <cite>server.js</cite></li>
                            <li>We’re also going to export our <cite>app</cite> variable in <cite>app.js</cite></li>
                        </ul>
                    </div>
                </div>
                <div class="section" id="what-our-app-js-looks-like">
                    <h3>What our app.js looks like</h3>
                    <div class="literal-block-wrapper docutils container" id="id9">
                        <div class="code-block-caption"><span class="caption-text">demo/supertest-demo/app.js</span></div>
                        <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="cm">/** general error handler */</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">||</span> <span class="mi">500</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
    <span class="nx">error</span><span class="o">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">app</span><span class="p">;</span>
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="section" id="what-our-server-js-looks-like">
                    <h3>What our server.js looks like</h3>
                    <div class="literal-block-wrapper docutils container" id="id10">
                        <div class="code-block-caption"><span class="caption-text">demo/supertest-demo/server.js</span></div>
                        <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./app&quot;</span><span class="p">)</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Server starting on port 3000&quot;</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="section" id="the-application-we-are-going-to-be-building">
                    <h3>The application we are going to be building</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>A simple API for CRUD on cats!</li>
                            <li>We’re going to be using an array for storage</li>
                            <li>We’ll move that logic into a file called <cite>fakeDb.js</cite></li>
                        </ul>
                    </div>
                    <div class="docutils container">
                        <div class="literal-block-wrapper docutils container" id="id11">
                            <div class="code-block-caption"><span class="caption-text">demo/supertest-demo/fakeDb.js</span></div>
                            <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">global</span><span class="p">.</span><span class="nx">cats</span> <span class="o">=</span> <span class="p">[];</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">cats</span><span class="p">;</span>
</pre></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section" id="what-our-test-setup-looks-like">
                    <h3>What our test setup looks like</h3>
                    <div class="literal-block-wrapper docutils container" id="id12">
                        <div class="code-block-caption"><span class="caption-text">demo/supertest-demo/routes/cats-routes.test.js</span></div>
                        <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;supertest&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;../app&quot;</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">cats</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;../fakeDb&quot;</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">pickles</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Pickles&quot;</span> <span class="p">};</span>

<span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">cats</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pickles</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">afterEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// make sure this *mutates*, not redefines, `cats`</span>
  <span class="nx">cats</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="section" id="what-should-i-test">
                    <h3>What should I test?</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>Getting all cats</li>
                            <li>Getting a single cat<ul>
                                <li>What finding successfully looks like</li>
                                <li>What happens when it is not found</li>
                            </ul>
                            </li>
                            <li>Deleting a cat<ul>
                                <li>What deleting successfully looks like</li>
                                <li>What happens when it is not found</li>
                            </ul>
                            </li>
                            <li>Adding a cat<ul>
                                <li>What creating successfully looks like</li>
                                <li>What happens when you create a duplicate cat</li>
                                <li>What happens when you are missing required data</li>
                            </ul>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="section" id="testing-reading">
                    <h3>Testing Reading</h3>
                    <div class="literal-block-wrapper docutils container" id="id13">
                        <div class="code-block-caption"><span class="caption-text">demo/supertest-demo/routes/cats-routes.test.js</span></div>
                        <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="cm">/** GET /cats - returns `{cats: [cat, ...]}` */</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;GET /cats&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">test</span><span class="p">(</span><span class="s2">&quot;Gets a list of cats&quot;</span><span class="p">,</span> <span class="nx">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">resp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="sb">`/cats`</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">({</span><span class="nx">cats</span><span class="o">:</span> <span class="p">[</span><span class="nx">pickles</span><span class="p">]});</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="section" id="testing-creating">
                    <h3>Testing Creating</h3>
                    <div class="literal-block-wrapper docutils container" id="id14">
                        <div class="code-block-caption"><span class="caption-text">demo/supertest-demo/routes/cats-routes.test.js</span></div>
                        <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="cm">/** POST /cats - create cat from data; return `{cat: cat}` */</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;POST /cats&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">test</span><span class="p">(</span><span class="s2">&quot;Creates a new cat&quot;</span><span class="p">,</span> <span class="nx">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">resp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="sb">`/cats`</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Ezra&quot;</span>
      <span class="p">});</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">({</span>
      <span class="nx">cat</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Ezra&quot;</span> <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="section" id="testing-updating">
                    <h3>Testing Updating</h3>
                    <div class="literal-block-wrapper docutils container" id="id15">
                        <div class="code-block-caption"><span class="caption-text">demo/supertest-demo/routes/cats-routes.test.js</span></div>
                        <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="cm">/** PATCH /cats/[name] - update cat; return `{cat: cat}` */</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;PATCH /cats/:name&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">test</span><span class="p">(</span><span class="s2">&quot;Updates a single cat&quot;</span><span class="p">,</span> <span class="nx">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">resp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="sb">`/cats/</span><span class="si">${</span><span class="nx">pickles</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Troll&quot;</span>
      <span class="p">});</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">({</span>
      <span class="nx">cat</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Troll&quot;</span> <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>

  <span class="nx">test</span><span class="p">(</span><span class="s2">&quot;Responds with 404 if id invalid&quot;</span><span class="p">,</span> <span class="nx">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">resp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">patch</span><span class="p">(</span><span class="sb">`/cats/0`</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="section" id="testing-deleting">
                    <h3>Testing Deleting</h3>
                    <div class="literal-block-wrapper docutils container" id="id16">
                        <div class="code-block-caption"><span class="caption-text">demo/supertest-demo/routes/cats-routes.test.js</span></div>
                        <div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="cm">/** DELETE /cats/[name] - delete cat,</span>
<span class="cm"> *  return `{message: &quot;Cat deleted&quot;}` */</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;DELETE /cats/:name&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">test</span><span class="p">(</span><span class="s2">&quot;Deletes a single a cat&quot;</span><span class="p">,</span> <span class="nx">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">resp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="k">delete</span><span class="p">(</span><span class="sb">`/cats/</span><span class="si">${</span><span class="nx">pickles</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&quot;Deleted&quot;</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="section" id="debugging-your-tests">
                    <h3>Debugging your tests</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>You can always <strong>console.log</strong> inside of your test files</li>
                            <li>If you’d like to use the chrome dev tools, write the following:<ul>
                                <li><code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">--inspect-brk</span> <span class="pre">$(which</span> <span class="pre">jest)</span> <span class="pre">--runInBand</span> <span class="pre">NAME_OF_FILE</span></code></li>
                            </ul>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="section" id="coming-up">
                    <h3>Coming Up</h3>
                    <div class="docutils container">
                        <ul class="simple">
                            <li>Adding PostgreSQL to Express</li>
                            <li>Testing using a Database</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>



    </div>
</div>
<script type="text/javascript" src="http://curric.rithmschool.com/springboard/lectures/express-router-middleware/_static/jquery.js"></script>
<script type="text/javascript" src="http://curric.rithmschool.com/springboard/lectures/express-router-middleware/_static/underscore.js"></script>
<script type="text/javascript" src="http://curric.rithmschool.com/springboard/lectures/express-router-middleware/_static/doctools.js"></script>
<script type="text/javascript" src="http://curric.rithmschool.com/springboard/lectures/express-router-middleware/_static/language_data.js"></script>
</body>
</html>